---
title: "Part 2"
author: "Pedro Lins"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load packages
library(gapminder)
library(tidyverse)
library(ggplot2)
```

# Load your data

```{r}
# Upload data as a .csv file
ds = "openpowerlifting.csv" 
df = read_csv(ds)
head(df)
```

# Exploratory Data Analysis
# Lifters Analysis
The goal here is to create a DSaaS (Data Science as a Service) that people can choose a lifter from the database and see his statistics. 

initially, lets evaluate the general formula for attempts index
if a lifter misses a lift, it shows as a negative value
if a lifter performed it, positive
so we want to count how many positives a lifter had and divide it by all attempts he did
this gives the probability of a lifter performing a good lift
this can be drilled down to each lift (squat, bench press, deadlift)
and by time (is it changing through time?)


```{r}
##################
# Attempts Index #
##################

#########
# Squat #
#########

Name1 = "Pedro Lins"

# First squat
sq1 = df %>%
  filter(Name == Name1) %>%
  count(Squat1Kg > 0)
colnames(sq1) = c("Squat1", "sq1")

  if(sq1[1,1] == TRUE){
    sq1idx = data.frame(c(1))
  } else {sq1idx = sq1[2,2] / (sq1[1,2] + sq1[2,2])
    }
colnames(sq1idx) = c("sq1idx")


# Second Squat
sq2 = df %>%
  filter(Name == Name1) %>%
  count(Squat2Kg > 0)
colnames(sq2) = c("Squat2", "sq2")

if(sq2[1,1] == TRUE){
    sq2idx = data.frame(c(1))
  } else {sq2idx = sq2[2,2] / (sq2[1,2] + sq2[2,2])
    }
colnames(sq2idx) = c("sq2idx")


# Thrid Squat
sq3 = df %>%
  filter(Name == Name1) %>%
  count(Squat3Kg > 0)
colnames(sq3) = c("Squat3", "sq3")

if(sq3[1,1] == TRUE){
    sq3idx = data.frame(c(1))
  } else {sq3idx = sq3[2,2] / (sq3[1,2] + sq3[2,2])
    }
colnames(sq3idx) = c("sq3idx")

# Fourth Squat will not get into the analysis since it is technically an outlier

sq = (sq1idx + sq2idx + sq3idx)/3
colnames(sq) = c("sq")
sq
```

```{r}
###############
# Bench Press #
###############

# First Bench Press
bp1 = df %>%
  filter(Name == Name1) %>%
  count(Bench1Kg > 0)
colnames(bp1) = c("Bench1", "bp1")

  if(bp1[1,1] == TRUE){
    bp1idx = data.frame(c(1))
  } else {bp1idx = bp1[2,2] / (bp1[1,2] + bp1[2,2])
    }
colnames(bp1idx) = c("bp1idx")
bp1idx

# Second Bench Press
bp2 = df %>%
  filter(Name == Name1) %>%
  count(Bench2Kg > 0)
colnames(bp2) = c("Bench2", "bp2")

  if(bp2[1,1] == TRUE){
    bp2idx = data.frame(c(1))
  } else {bp2idx = bp2[2,2] / (bp2[1,2] + bp2[2,2])
    }
colnames(bp2idx) = c("bp2idx")
bp2idx

# Thrid Bench Press
bp3 = df %>%
  filter(Name == Name1) %>%
  count(Bench3Kg > 0)
colnames(bp3) = c("Bench3", "bp3")

  if(bp3[1,1] == TRUE){
    bp3idx = data.frame(c(1))
  } else {bp3idx = bp3[2,2] / (bp3[1,2] + bp3[2,2])
    }

colnames(bp3idx) = c("bp3idx")


# Fourth Bench press will not get into the analysis since it is technically an outlier

bp = (bp1idx + bp2idx + bp3idx)/3
colnames(bp) = c("bp")
bp
```

```{r}
############
# Deadlift #
############

# First Deadlift
dl1 = df %>%
  filter(Name == Name1) %>%
  count(Deadlift1Kg > 0)
colnames(dl1) = c("Deadlift1", "dl1")

  if(dl1[1,1] == TRUE){
    dl1idx = data.frame(c(1))
  } else {dl1idx = dl1[2,2] / (dl1[1,2] + dl1[2,2])
    }
colnames(dl1idx) = c("dl1idx")
dl1idx

# Second Deadlift
dl2 = df %>%
  filter(Name == Name1) %>%
  count(Deadlift2Kg > 0)
colnames(dl2) = c("Deadlift2", "dl2")

  if(dl2[1,1] == TRUE){
    dl2idx = data.frame(c(1))
  } else {dl2idx = dl2[2,2] / (dl2[1,2] + dl2[2,2])
    }
colnames(dl2idx) = c("dl2idx")
dl2idx

# Thrid Deadlift
dl3 = df %>%
  filter(Name == Name1) %>%
  count(Deadlift3Kg > 0)
colnames(dl3) = c("Deadlift3", "dl3")

  if(dl3[1,1] == TRUE){
    dl3idx = data.frame(c(1))
  } else {dl3idx = dl3[2,2] / (dl3[1,2] + dl3[2,2])
    }
colnames(dl3idx) = c("dl3idx")
dl3idx

# Fourth Bench press will not get into the analysis since it is technically an outlier

dl = (dl1idx + dl2idx + dl3idx)/3
colnames(dl) = c("dl")
dl
```

```{r}
#################
# Overall Index #
#################

index = (sq + bp + dl)/3
sq_index = data.frame(sq1idx, sq2idx, sq3idx, sq)
sq_trans <- as.data.frame(t(sq_index))
sq_trans
bp_index = data.frame(bp1idx, bp2idx, bp3idx, bp)
bp_trans<- as.data.frame(t(bp_index))
bp_trans
dl_index = data.frame(dl1idx, dl2idx, dl3idx, dl)
dl_trans<- as.data.frame(t(dl_index))
dl_trans


Attempts = c(1,2,3,"Average")
lifteridx = c(sq, bp, dl, index)

df_lifter = data.frame(Attempts, sq_trans, bp_trans, dl_trans, lifteridx)
colnames(df_lifter) = c("Attempts", "Squat", "Bench", "Deadlift", "Index")
print(df_lifter)

p1 = ggplot(df_lifter, aes(y = Squat, x = Attempts))+
         geom_col()
p2 = ggplot(df_lifter, aes(y = Bench, x = Attempts))+
         geom_col()
p3 = ggplot(df_lifter, aes(y = Deadlift, x = Attempts))+
         geom_col()
p4 = ggplot(df_lifter, aes(y = Index, x = Attempts))+
         geom_col()

```

Now I want to understand how much (on average?) the lifter increases weight between attempts.

then, how much did he increased when re failed

but first, lets see how much he jumps on each lift, on average

```{r}
###############
# Squat Jumps #
###############

sq11 = df %>%
  filter(Name == Name1)

sqjump1 = abs(sq11[,12]) - abs(sq11[,11])
  sqjump1
  
sqjump2 = abs(sq11[,13]) - abs(sq11[,12])
  sqjump2
  
sqjumpdf = data.frame(sqjump1, sqjump2)
colnames(sqjumpdf) = c("Jump1", "Jump2")
sqjumpdf

mean(sqjumpdf$Jump1)
mean(sqjumpdf$Jump2)

#############################
# Second squat missed jumps #
#############################

sq12 = df %>%
  filter(Name == Name1) %>%
  filter(Squat2Kg < 0)
  sq12

sqjump12 = abs(sq12[,12]) - abs(sq12[,11])
sqjump12
  
sqjump22 = abs(sq12[,13]) - abs(sq12[,12])
sqjump22
  
sqjumpdf2 = data.frame(sqjump12, sqjump22)
colnames(sqjumpdf2) = c("Jump12", "Jump22")
sqjumpdf2

mean(sqjumpdf2$Jump12)

  

############################
# Third squat missed jumps #
############################

sq13 = df %>%
  filter(Name == Name1) %>%
  filter(Squat3Kg < 0)
  sq13

sqjump13 = abs(sq13[,12]) - abs(sq13[,11])
sqjump13
  
sqjump23 = abs(sq13[,13]) - abs(sq13[,12])
sqjump23
  
sqjumpdf3 = data.frame(sqjump13, sqjump23)
colnames(sqjumpdf3) = c("Jump13", "Jump23")
sqjumpdf3


mean(sqjumpdf3$Jump23)


##########################
# Attempts % comparison #
##########################

# When your second is a good lift, how much percentage is it from the first?
sq14 = df %>%
  filter(Name == Name1) %>%
  filter(Squat2Kg < 0)
  sq14

sqjump14 = 100 * (1 - (abs(sq14[,12]) / abs(sq14[,11])))
sqjump14
  
sqjump24 = 100 * (1 - (abs(sq14[,13]) / abs(sq14[,12])))
sqjump24
  
sqjumpdf4 = data.frame(sqjump14, sqjump24)
colnames(sqjumpdf4) = c("Jump14", "Jump24")
sqjumpdf4

mean(sqjumpdf4$Jump14)

# When your third is a good lift, how much percentage is it from the second?
sq15 = df %>%
  filter(Name == Name1) %>%
  filter(Squat3Kg < 0)
  sq15

sqjump15 = 100 * (1 - (abs(sq15[,12]) / abs(sq15[,11])))
sqjump15
  
sqjump25 = 100 * (1 - (abs(sq15[,13]) / abs(sq15[,12])))
sqjump25
  
sqjumpdf5 = data.frame(sqjump15, sqjump25)
colnames(sqjumpdf5) = c("Jump15", "Jump25")
sqjumpdf5

mean(sqjumpdf5$Jump25)


###########################
# Attempts % when 3 for 3 #
###########################

sq16 = df %>%
  filter(Name == Name1) %>%
  filter(Squat1Kg > 0) %>%
  filter(Squat2Kg > 0) %>%
  filter(Squat3Kg > 0) 
  sq16

sqjump16 = 100 * (1 - (abs(sq16[,12]) / abs(sq16[,11])))
sqjump16
  
sqjump26 = 100 * (1 - (abs(sq16[,13]) / abs(sq16[,12])))
sqjump26
  
sqjumpdf6 = data.frame(sqjump16, sqjump26)
colnames(sqjumpdf6) = c("Jump16", "Jump26")
sqjumpdf6

mean(sqjumpdf6$Jump16)
mean(sqjumpdf6$Jump26)
mean(sqjumpdf6$Jump16) + mean(sqjumpdf6$Jump26)
  
```

